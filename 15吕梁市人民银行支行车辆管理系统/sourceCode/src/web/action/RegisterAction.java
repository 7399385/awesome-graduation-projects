/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package web.action;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import common.exception.UserException;
import common.util.BeanFactory;
import common.util.MD5;

import service.IUserService;

import dao.bean.User;
import web.form.RegisterForm;

/**
 * MyEclipse Struts Creation date: 04-16-2002
 * 
 * XDoclet definition:
 * 
 * @struts.action path="/registerAction" name="RegisterForm"
 *                input="/pages/register.jsp" scope="request"
 * @struts.action-forward name="success" path="/pages/login.jsp" redirect="true"
 * @struts.action-forward name="failure" path="/pages/register.jsp"
 */
public class RegisterAction extends Action {
	/*
	 * Generated Methods
	 */

	/**
	 * Method execute
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		RegisterForm registerform = (RegisterForm) form;
		HttpSession session = request.getSession();
		IUserService service = (IUserService) BeanFactory
				.getBean("userService");
		String nickname = registerform.getNickName();
		try {
			User user = new User();
			user.setNickname(nickname);
			String passwd = registerform.getPasswd();
			MD5 md5 = MD5.getInstance();
			String password = md5.getMD5Str(passwd);
			user.setPassword(password);
			String name = registerform.getName();
			user.setName(name);
			String gender = registerform.getGender();
			user.setGender(gender);
			String identitycar = registerform.getIdentitycar();
			user.setIdentitycard(identitycar);
			String pwquestion = registerform.getPasswdQuestion();
			user.setPasswdquestion(pwquestion);
			String pwanswer = registerform.getPasswdAnswer();
			user.setPasswdanswer(pwanswer);
			long age=registerform.getAge();
			user.setAge(age);
			String phone = registerform.getPhone();
			user.setPhone(phone);
			String address = registerform.getAddress();
			user.setAddress(address);
			service.register(user);
			session.setAttribute("message", "注册成功");
			return mapping.findForward("success");
		} catch (UserException e) {
			e.printStackTrace();
			session.setAttribute("message", e.getMessage());
			return mapping.findForward("failure");
		}
	}
}